{% extends "baseof.html" %}
{% set active_page = "VulnList" %}

{% block content %}
<h1 class="text-center mb-4">Vulnerability List</h1>

<div class="table-responsive">
    <table class="table table-dark table-hover">
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">CVE</th>
                <th scope="col">CVSS</th>
                <th scope="col">Vulnerability Name</th>
                <th scope="col">Exploit Available</th>
                <th scope="col">Created Date</th>
                <th scope="col">Updated Date</th>
                <th scope="col">Check Date</th>
                <th scope="col">Action</th>
            </tr>
        </thead>
        <tbody class="table-group-divider">
            {% for vuln in vulns %}
            <tr>
                <th scope="row">{{ vuln.id }}</th>
                <td>{{ vuln.cve }}</td>
                <td>{{ vuln.cvss }}</td>
                <td>{{ vuln.vuln_name }}</td>
                <td>{{ vuln.exploit_available }}</td>
                <td>{{ vuln.created_date }}</td>

                {% if vuln.updated_date %}
                <td>{{ vuln.updated_date }}</td>
                {% else %}
                <td>Not Updated</td>
                {% endif %}

                {% if vuln.check_date %}
                <td>{{ vuln.check_date }}</td>
                {% else %}
                <td>Not Checked</td>
                {% endif %}

                <td>
                    <div class="btn-group" role="group" aria-label="Basic example">
                        <button type="button" class="btn btn-warning text-white" data-bs-toggle="modal"
                            data-bs-target="#detailsModel{{ vuln.id }}">
                            <i class="bi-eye-fill"></i>
                        </button>
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal"
                            data-bs-target="#editModal{{ vuln.id }}">
                            <i class="bi-pencil-fill"></i>
                        </button>
                    </div>
                </td>
            </tr>

            <!-- Details Modal -->
            <div class="modal fade" id="detailsModel{{ vuln.id }}" tabindex="-1" aria-labelledby="detailsModelLabel"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
                    <div class="modal-content bg-dark text-white">
                        <div class="modal-header" data-bs-theme="dark">
                            <h1 class="modal-title fs-5" id="detailsModelLabel">Vulnerability Details</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="inputCVE" class="form-label">CVE</label>
                                    <input class="form-control" type="text" value="{{ vuln.cve }}" readonly>
                                </div>
                                <div class="col-md-3">
                                    <label for="inputCVSS" class="form-label">CVSS</label>
                                    <input class="form-control" type="text" value="{{ vuln.cvss }}" readonly>
                                </div>
                                <div class="col-md-3">
                                    <label for="inputExploitAvailable" class="form-label">Exploit Available</label>
                                    <input class="form-control" type="text" value="{{ vuln.exploit_available }}"
                                        readonly>
                                </div>
                                <div class="col-12">
                                    <label for="inputName" class="form-label">Vulnerability Name</label>
                                    <input class="form-control" type="text" value="{{ vuln.vuln_name }}" readonly>
                                </div>
                                <div class="col-md-4">
                                    <label for="inputCreatedDate" class="form-label">Created Date</label>
                                    <input class="form-control" type="text" value="{{ vuln.created_date }}" readonly>
                                </div>
                                <div class="col-md-4">
                                    <label for="inputUpdatedDate" class="form-label">Updated Date</label>
                                    <input class="form-control" type="text" value="{{ vuln.updated_date }}" readonly>
                                </div>
                                <div class="col-md-4">
                                    <label for="inputCheckDate" class="form-label">Check Date</label>
                                    <input class="form-control" type="text" value="{{ vuln.check_date }}" readonly>
                                </div>
                                <div class="col-12">
                                    <label for="inputExploitAvailable" class="form-label">Notes</label>
                                    <textarea class="form-control" style="height: 100px"
                                        readonly>{{ vuln.notes }}</textarea>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer justify-content-center">
                            <button type="button" class="btn btn-danger col-3" disabled>Delete</button>
                            <button type="button" class="btn btn-primary col-3"
                                data-bs-target="#editModal{{ vuln.id }}" data-bs-toggle="modal">Edit</button>
                            <button type="button" class="btn btn-secondary col-3" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Edit Modal -->
            <div class="modal fade" id="editModal{{ vuln.id }}" data-bs-backdrop="static" data-bs-keyboard="false"
                tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
                    <div class="modal-content bg-dark text-white">
                        <div class="modal-header" data-bs-theme="dark">
                            <h1 class="modal-title fs-5" id="editModalLabel">Vulnerability Edit</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="inputCVE" class="form-label">CVE</label>
                                    <input class="form-control" type="text" value="{{ vuln.cve }}">
                                </div>
                                <div class="col-md-3">
                                    <label for="inputCVSS" class="form-label">CVSS</label>
                                    <input class="form-control" type="text" value="{{ vuln.cvss }}">
                                </div>
                                <div class="col-md-3">
                                    <label for="inputExploitAvailable" class="form-label">Exploit Available</label>
                                    <input class="form-control" type="text" value="{{ vuln.exploit_available }}">
                                </div>
                                <div class="col-12">
                                    <label for="inputName" class="form-label">Vulnerability Name</label>
                                    <input class="form-control" type="text" value="{{ vuln.vuln_name }}">
                                </div>
                                <div class="col-md-4">
                                    <label for="inputCreatedDate" class="form-label">Created Date</label>
                                    <input class="form-control" type="text" value="{{ vuln.created_date }}" readonly>
                                </div>
                                <div class="col-md-4">
                                    <label for="inputUpdatedDate" class="form-label">Updated Date</label>
                                    <input class="form-control" type="text" value="{{ vuln.updated_date }}" readonly>
                                </div>
                                <div class="col-md-4">
                                    <label for="inputCheckDate" class="form-label">Check Date</label>
                                    <input class="form-control" type="text" value="{{ vuln.check_date }}" readonly>
                                </div>
                                <div class="col-12">
                                    <label for="inputExploitAvailable" class="form-label">Notes</label>
                                    <textarea class="form-control" style="height: 100px">{{ vuln.notes }}</textarea>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer justify-content-center">
                            <button type="button" class="btn btn-danger col-3" disabled>Delete</button>
                            <button type="button" class="btn btn-success col-3">Save Changes</button>
                            <button type="button" class="btn btn-secondary col-3"
                                data-bs-dismiss="modal">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>

            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}