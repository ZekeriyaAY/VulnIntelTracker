from flask_wtf import FlaskForm
from wtforms import StringField, FloatField, TextAreaField, SubmitField
from wtforms.validators import DataRequired, ValidationError, Length, NumberRange, Optional
from .models import Vulnerability


class VulnerabilityForm(FlaskForm):
    cve = StringField('CVE', validators=[DataRequired(), Length(max=20)])
    # cvss = FloatField('CVSS', validators=[Optional(), NumberRange(min=0.0, max=10.0)])
    # name = StringField('Name', validators=[Length(max=64)])
    # description = TextAreaField('Description', validators=[Length(max=500)])
    # exploit_available = StringField(
    #     'Exploit Available', validators=[Length(max=10)])
    submit = SubmitField('Submit')

    def validate_cve(self, cve):
        vulnerability = Vulnerability.query.get(cve.data)
        if vulnerability is not None:
            raise ValidationError(
                'Please use a different CVE or update the existing one.')
