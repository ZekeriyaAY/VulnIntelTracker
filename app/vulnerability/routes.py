from flask import render_template, url_for, flash, redirect
from flask_login import login_required
from app import db
from app.vulnerability import bp
from app.vulnerability.models import Vulnerability
from app.vulnerability.add import VulnerabilityForm


@bp.route('/vulnerability/add', methods=['GET', 'POST'])
@login_required
def vulnerability_add():
    form = VulnerabilityForm()
    if form.validate_on_submit():
        vulnerability = Vulnerability(
            cve=form.cve.data,
            cvss=form.cvss.data,
            name=form.name.data,
            description=form.description.data,
            exploit_available=form.exploit_available.data
        )
        db.session.add(vulnerability)
        db.session.commit()
        flash('Your vulnerability({}) has been added.'.format(
            form.cve.data), 'success')
        return redirect(url_for('main.index'))

    return render_template('vulnerability/add.html', form=form)


@bp.route('/vulnerability/list')
@login_required
def vulnerability_list():
    vulnerabilities = Vulnerability.query.all()
    return render_template('vulnerability/list.html', vulnerabilities=vulnerabilities)


@bp.route('/vulnerability/edit/<int:id>', methods=['GET', 'POST'])
@login_required
def vulnerability_edit(id):
    pass


@bp.route('/vulnerability/delete/<int:id>', methods=['POST'])
@login_required
def vulnerability_delete(id):
    pass
